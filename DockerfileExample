FROM dcreg.service.consul/dev/development-dotnet-core-sdk-common:6.0
# AS build-env

ARG BUILD_NUMBER=undefined
ARG GIT_BRANCH=undefined
ARG GIT_COMMIT=undefined

# build scripts
COPY ./build.sh /app/
COPY ./build.fsx /app/
COPY ./paket.dependencies /app/
COPY ./paket.references /app/
COPY ./paket.lock /app/

# sources
COPY ./KafkaApplication.fsproj /app/
COPY ./src /app/src

# example
COPY ./example/.env /app/example/
COPY ./example/example.fsproj /app/example/
COPY ./example/Program.fs /app/example/
COPY ./example/RealLife.fs /app/example/

# others
COPY ./.git /app/.git
COPY ./.config /app/.config
COPY ./CHANGELOG.md /app/

WORKDIR /app
RUN ./build.sh -t Build no-clean

WORKDIR /app/example
RUN dotnet build -c Release

EXPOSE 8080

WORKDIR /app/example

ENTRYPOINT ["dotnet", "bin/Release/net6.0/example.dll"]
